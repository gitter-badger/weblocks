<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Quickstart &#8212; weblocks/reblocks 0.30.0 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootswatch-3.3.6/yeti/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.30.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="top" title="weblocks/reblocks 0.30.0 documentation" href="index.html" />
    <link rel="next" title="Components of Weblocks" href="components.html" />
    <link rel="prev" title="Installation" href="installation.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          weblocks/reblocks</a>
        <span class="navbar-text navbar-version pull-left"><b>0.30</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="changelog.html">Changelog</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Documentation <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="components.html">Components of Weblocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="stores.html">Stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="widgets.html">Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="hooks.html">Request Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="forms.html">Forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="views.html">Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="continuations.html">Continuation-based tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="dependencies.html">Dependency handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="html.html">HTML generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="adapting.html">Adapting Weblocks to your needs</a></li>
<li class="toctree-l1"><a class="reference internal" href="internals.html">Weblocks Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to Weblocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="hints.html">Hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">ChangeLog</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Quickstart</a><ul>
<li><a class="reference internal" href="#what-is-next">What is next?</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="quickstart">
<h1>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This version of Weblocks is not in the Quicklisp yet. To
install it you need to clone the repository somewhere where
ASDF will find it, for example, to <code class="docutils literal"><span class="pre">~/common-lisp/</span></code> directory.</p>
</div>
<p>Load weblocks and create a package for a sandbox:</p>
<div class="highlight-common-lisp-repl"><div class="highlight"><pre><span></span><span class="gp">CL-USER&gt; </span><span class="p">(</span><span class="nv">ql:quickload</span> <span class="o">&#39;</span><span class="p">(</span><span class="ss">:weblocks</span> <span class="ss">:find-port</span><span class="p">))</span><span class="go"></span>
<span class="gp">CL-USER&gt; </span><span class="p">(</span><span class="nb">defpackage</span> <span class="nv">todo</span>
           <span class="p">(</span><span class="ss">:use</span> <span class="ss">#:cl</span>
                 <span class="ss">#:weblocks/html</span><span class="p">)</span>
           <span class="p">(</span><span class="ss">:import-from</span> <span class="ss">#:weblocks/app</span>
                         <span class="ss">#:defapp</span><span class="p">))</span><span class="go"></span>
<span class="go">#&lt;PACKAGE &quot;TODO&quot;&gt;</span>
<span class="gp">CL-USER&gt; </span><span class="p">(</span><span class="nb">in-package</span> <span class="nv">todo</span><span class="p">)</span><span class="go"></span>
<span class="go">#&lt;PACKAGE &quot;TODO&quot;&gt;</span>
</pre></div>
</div>
<p>Now, create an application:</p>
<div class="highlight-common-lisp-repl"><div class="highlight"><pre><span></span><span class="gp">TODO&gt; </span><span class="p">(</span><span class="nv">defapp</span> <span class="nv">tasks</span><span class="p">)</span><span class="go"></span>
<span class="gp">TODO&gt; </span><span class="p">(</span><span class="nv">weblocks/debug:on</span><span class="p">)</span><span class="go"></span>
<span class="gp">TODO&gt; </span><span class="p">(</span><span class="nb">defvar</span> <span class="vg">*port*</span> <span class="p">(</span><span class="nv">find-port:find-port</span><span class="p">))</span><span class="go"></span>
<span class="gp">TODO&gt; </span><span class="p">(</span><span class="nv">weblocks/server:start</span> <span class="ss">:port</span> <span class="vg">*port*</span><span class="p">)</span><span class="go"></span>
</pre></div>
</div>
<p>Open <a class="reference external" href="http://localhost:8080/tasks/">http://localhost:8080/tasks/</a> in your browser and you&#8217;ll see a
text like that:</p>
<div class="highlight-common-lisp"><div class="highlight"><pre><span></span><span class="nv">No</span> <span class="nv">weblocks/session:init</span> <span class="nc">method</span> <span class="nv">defined.</span>
<span class="nv">Please</span> <span class="nv">define</span> <span class="nv">a</span> <span class="nc">method</span> <span class="nv">weblocks.session:init</span> <span class="nv">to</span> <span class="nv">initialize</span> <span class="nv">a</span> <span class="nv">session.</span>

<span class="nv">It</span> <span class="nv">could</span> <span class="nv">be</span> <span class="nv">something</span> <span class="nv">simple,</span> <span class="nv">like</span> <span class="nv">this</span> <span class="nv">one:</span>

<span class="p">(</span><span class="nb">defmethod</span> <span class="nv">weblocks/session:init</span> <span class="p">((</span><span class="nv">app</span> <span class="nv">tasks</span><span class="p">))</span>
            <span class="s">&quot;Hello world!&quot;</span><span class="p">)</span>

<span class="nv">Read</span> <span class="nv">more</span> <span class="nv">in</span> <span class="nv">documentaion.</span>
</pre></div>
</div>
<p>It means that you didn&#8217;t write any code for your application. Let&#8217;s do
it now and make an application which outputs a list of tasks.</p>
<p>In the end, we&#8217;ll build the mandatory TODO-list app:</p>
<img alt="the TODO-list app in Weblocks." class="align-center" src="_images/quickstart-check-task.gif" />
<div class="highlight-common-lisp-repl"><div class="highlight"><pre><span></span><span class="gp">TODO&gt; </span><span class="p">(</span><span class="nb">defmethod</span> <span class="nv">weblocks/session:init</span> <span class="p">((</span><span class="nv">app</span> <span class="nv">tasks</span><span class="p">))</span>
        <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">tasks</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;Make my first app in Weblocks&quot;</span>
                       <span class="s">&quot;Deploy it somewhere&quot;</span>
                       <span class="s">&quot;Have a profit&quot;</span><span class="p">)))</span>
          <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
            <span class="p">(</span><span class="nv">with-html</span>
              <span class="p">(</span><span class="ss">:h1</span> <span class="s">&quot;Tasks&quot;</span><span class="p">)</span>
              <span class="p">(</span><span class="ss">:ul</span> <span class="ss">:class</span> <span class="s">&quot;tasks&quot;</span>
                   <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">task</span> <span class="nv">in</span> <span class="nv">tasks</span>
                         <span class="nb">do</span> <span class="p">(</span><span class="nv">with-html</span>
                              <span class="p">(</span><span class="ss">:li</span> <span class="nv">task</span><span class="p">))))))))</span><span class="go"></span>
</pre></div>
</div>
<p>This code defined a list of tasks. For simplicity, they are defined as a
list in a memory. Then it renders these tasks as HTML <code class="docutils literal"><span class="pre">ul</span></code> block.</p>
<p>Restart the application:</p>
<div class="highlight-common-lisp-repl"><div class="highlight"><pre><span></span><span class="gp">TODO&gt; </span><span class="p">(</span><span class="nv">weblocks/debug:reset-latest-session</span><span class="p">)</span><span class="go"></span>
</pre></div>
</div>
<p>Right now it should look like this:</p>
<a class="reference internal image-reference" href="_images/quickstart-list.png"><img alt="Our first list of tasks." class="align-center" src="_images/quickstart-list.png" style="width: 400px;" /></a>
<p>Now, we&#8217;ll add some ability to interact with a list – to add some tasks
into it, like so:</p>
<img alt="Adding tasks in our TODO-list interactively." class="align-center" src="_images/quickstart-add-task.gif" />
<p>Import a new module, <code class="docutils literal"><span class="pre">weblocks-ui</span></code> to help in creating forms and other UI elements:</p>
<div class="highlight-common-lisp-repl"><div class="highlight"><pre><span></span><span class="gp">TODO&gt; </span><span class="p">(</span><span class="nv">ql:quickload</span> <span class="s">&quot;weblocks-ui&quot;</span><span class="p">)</span><span class="go"></span>
<span class="gp">TODO&gt; </span><span class="p">(</span><span class="nb">use-package</span> <span class="ss">:weblocks-ui/form</span><span class="p">)</span><span class="go"></span>
</pre></div>
</div>
<p>Write a new <code class="docutils literal"><span class="pre">init</span></code> method in the repl:</p>
<div class="highlight-common-lisp-repl"><div class="highlight"><pre><span></span><span class="gp">TODO&gt; </span><span class="p">(</span><span class="nb">defmethod</span> <span class="nv">weblocks/session:init</span> <span class="p">((</span><span class="nv">app</span> <span class="nv">tasks</span><span class="p">))</span>
        <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">tasks</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;Make my first app in Weblocks&quot;</span>
                       <span class="s">&quot;Deploy it somewhere&quot;</span>
                       <span class="s">&quot;Have a profit&quot;</span><span class="p">)))</span>
          <span class="p">(</span><span class="k">flet</span> <span class="p">((</span><span class="nv">add-task</span> <span class="p">(</span><span class="k">&amp;key</span> <span class="nv">task</span> <span class="k">&amp;allow-other-keys</span><span class="p">)</span>
                   <span class="p">(</span><span class="nb">push</span> <span class="nv">task</span> <span class="nv">tasks</span><span class="p">)</span>
                   <span class="p">(</span><span class="nv">weblocks/widget:update</span>
                       <span class="p">(</span><span class="nv">weblocks/widgets/root:get</span><span class="p">))))</span>
            <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
              <span class="p">(</span><span class="nv">with-html</span>
                <span class="p">(</span><span class="ss">:h1</span> <span class="s">&quot;Tasks&quot;</span><span class="p">)</span>
                <span class="p">(</span><span class="ss">:ul</span> <span class="ss">:class</span> <span class="s">&quot;tasks&quot;</span>
                     <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">task</span> <span class="nv">in</span> <span class="nv">tasks</span>
                           <span class="nb">do</span> <span class="p">(</span><span class="nv">with-html</span>
                                <span class="p">(</span><span class="ss">:li</span> <span class="nv">task</span><span class="p">))))</span>
                <span class="p">(</span><span class="nv">with-html-form</span> <span class="p">(</span><span class="ss">:POST</span> <span class="nf">#&#39;</span><span class="nv">add-task</span><span class="p">)</span>
                  <span class="p">(</span><span class="ss">:input</span> <span class="ss">:type</span> <span class="s">&quot;text&quot;</span>
                          <span class="ss">:name</span> <span class="s">&quot;task&quot;</span>
                          <span class="ss">:placeholder</span> <span class="s">&quot;Task&#39;s title&quot;</span><span class="p">)</span>
                  <span class="p">(</span><span class="ss">:input</span> <span class="ss">:type</span> <span class="s">&quot;submit&quot;</span>
                          <span class="ss">:value</span> <span class="s">&quot;Add&quot;</span><span class="p">)))))))</span><span class="go"></span>
</pre></div>
</div>
<p>Pay attention to two new blocks in this code. Now it has the inner function
<code class="docutils literal"><span class="pre">add-task</span></code>:</p>
<div class="highlight-common-lisp"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">add-task</span> <span class="p">(</span><span class="k">&amp;key</span> <span class="nv">task</span> <span class="k">&amp;allow-other-keys</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">push</span> <span class="nv">task</span> <span class="nv">tasks</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">weblocks/widget:update</span>
     <span class="p">(</span><span class="nv">weblocks/widgets/root:get</span><span class="p">)))</span>
</pre></div>
</div>
<p>It does only two simple things:</p>
<ul class="simple">
<li>it adds a task into a list;</li>
<li>it tells Weblocks that the whole page should be redrawn.</li>
</ul>
<p>This second point is really important because it allows Weblocks to render
necessary parts of the page on the server and to inject it into the HTML DOM
in the browser. Here it rerenders the whole page, but later you&#8217;ll see that
the same technic can be used to update smaller pieces, called <a class="reference internal" href="widgets.html#widgets"><span class="std std-ref">Widgets</span></a>.</p>
<p>Another block in our new version of init-user-session is the form:</p>
<div class="highlight-common-lisp"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">with-html-form</span> <span class="p">(</span><span class="ss">:POST</span> <span class="nf">#&#39;</span><span class="nv">add-task</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">:input</span> <span class="ss">:type</span> <span class="s">&quot;text&quot;</span>
    <span class="ss">:name</span> <span class="s">&quot;task&quot;</span>
    <span class="ss">:placeholder</span> <span class="s">&quot;Task&#39;s title&quot;</span><span class="p">)</span>
   <span class="p">(</span><span class="ss">:input</span> <span class="ss">:type</span> <span class="s">&quot;submit&quot;</span>
    <span class="ss">:value</span> <span class="s">&quot;Add&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>It defines a text field, a submit button and an action to perform on
form submit.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>This is really amazing!</p>
<p class="last">With Weblocks, you can handle all the business logic
server-side, because an action can be any lisp function, even an
anonymous lambda, closuring all necessary variables.</p>
</div>
<p>Restart the application and reload the page. Test your form now and see in a
<a class="reference external" href="https://developers.google.com/web/tools/chrome-devtools/inspect-styles/">Webinspector</a> how Weblocks sends requests to the server and receives
HTML code with rendered HTML block.</p>
<p>Now we&#8217;ll make our application really useful – wekll add code to toggle tasks:</p>
<div class="highlight-common-lisp-repl"><div class="highlight"><pre><span></span><span class="gp">TODO&gt; </span><span class="p">(</span><span class="nb">defstruct</span> <span class="nv">task</span>
        <span class="p">(</span><span class="nv">title</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">done</span><span class="p">))</span><span class="go"></span>

<span class="gp">TODO&gt; </span><span class="p">(</span><span class="nb">defmethod</span> <span class="nv">weblocks/session:init</span> <span class="p">((</span><span class="nv">app</span> <span class="nv">tasks</span><span class="p">))</span>
        <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">tasks</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="nv">make-task</span> <span class="ss">:title</span> <span class="s">&quot;Make my first app in Weblocks&quot;</span> <span class="ss">:done</span> <span class="no">t</span><span class="p">)</span>
                           <span class="p">(</span><span class="nv">make-task</span> <span class="ss">:title</span> <span class="s">&quot;Deploy it somewhere&quot;</span> <span class="ss">:done</span> <span class="no">nil</span><span class="p">)</span>
                           <span class="p">(</span><span class="nv">make-task</span> <span class="ss">:title</span> <span class="s">&quot;Have a profit&quot;</span> <span class="ss">:done</span> <span class="no">nil</span><span class="p">))))</span>
          <span class="p">(</span><span class="k">labels</span> <span class="p">((</span><span class="nv">redraw</span> <span class="p">()</span>
                     <span class="p">(</span><span class="nv">weblocks/widget:update</span>
                         <span class="p">(</span><span class="nv">weblocks/widgets/root:get</span><span class="p">)))</span>
                   <span class="p">(</span><span class="nv">add-task</span> <span class="p">(</span><span class="k">&amp;rest</span> <span class="nb">rest</span> <span class="k">&amp;key</span> <span class="nv">task</span> <span class="k">&amp;allow-other-keys</span><span class="p">)</span>
                     <span class="p">(</span><span class="nv">log:info</span> <span class="s">&quot;Pushing&quot;</span> <span class="nv">task</span> <span class="s">&quot;to&quot;</span> <span class="nv">tasks</span> <span class="nb">rest</span><span class="p">)</span>
                     <span class="p">(</span><span class="nb">push</span> <span class="p">(</span><span class="nv">make-task</span> <span class="ss">:title</span> <span class="nv">task</span> <span class="ss">:done</span> <span class="no">nil</span><span class="p">)</span> <span class="nv">tasks</span><span class="p">)</span>
                     <span class="p">(</span><span class="nv">redraw</span><span class="p">))</span>
                   <span class="p">(</span><span class="nv">toggle-task</span> <span class="p">(</span><span class="nv">task</span><span class="p">)</span>
                     <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nv">task-done</span> <span class="nv">task</span><span class="p">)</span>
                           <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">task-done</span> <span class="nv">task</span><span class="p">)</span>
                               <span class="no">nil</span>
                               <span class="no">t</span><span class="p">))</span>
                     <span class="p">(</span><span class="nv">redraw</span><span class="p">))</span>
                   <span class="p">(</span><span class="nv">render-task</span> <span class="p">(</span><span class="nv">task</span><span class="p">)</span>
                     <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">title</span> <span class="p">(</span><span class="nv">task-title</span> <span class="nv">task</span><span class="p">))</span>
                           <span class="p">(</span><span class="nv">done</span> <span class="p">(</span><span class="nv">task-done</span> <span class="nv">task</span><span class="p">)))</span>
                       <span class="p">(</span><span class="nv">with-html</span>
                         <span class="p">(</span><span class="ss">:p</span> <span class="p">(</span><span class="ss">:input</span> <span class="ss">:type</span> <span class="s">&quot;checkbox&quot;</span>
                                     <span class="ss">:checked</span> <span class="nv">done</span>
                                     <span class="ss">:onclick</span> <span class="p">(</span><span class="nv">weblocks/actions:make-js-action</span>
                                               <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="k">&amp;rest</span> <span class="nb">rest</span><span class="p">)</span>
                                                 <span class="p">(</span><span class="k">declare</span> <span class="p">(</span><span class="k">ignore</span> <span class="nb">rest</span><span class="p">))</span>
                                                 <span class="p">(</span><span class="nv">toggle-task</span> <span class="nv">task</span><span class="p">))))</span>
                             <span class="p">(</span><span class="ss">:span</span> <span class="p">(</span><span class="k">if</span> <span class="nv">done</span>
                                        <span class="p">(</span><span class="nv">with-html</span> <span class="p">(</span><span class="ss">:s</span> <span class="nv">title</span><span class="p">))</span>
                                        <span class="nv">title</span><span class="p">)))))))</span>
            <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
              <span class="p">(</span><span class="nv">with-html</span>
                <span class="p">(</span><span class="ss">:h1</span> <span class="s">&quot;Tasks&quot;</span><span class="p">)</span>
                <span class="p">(</span><span class="ss">:div</span> <span class="ss">:class</span> <span class="s">&quot;tasks&quot;</span>
                      <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">task</span> <span class="nv">in</span> <span class="nv">tasks</span>
                            <span class="nb">do</span> <span class="p">(</span><span class="nv">with-html</span> <span class="p">(</span><span class="nv">render-task</span> <span class="nv">task</span><span class="p">))))</span>
                <span class="p">(</span><span class="nv">with-html-form</span> <span class="p">(</span><span class="ss">:POST</span> <span class="nf">#&#39;</span><span class="nv">add-task</span><span class="p">)</span>
                  <span class="p">(</span><span class="ss">:input</span> <span class="ss">:type</span> <span class="s">&quot;text&quot;</span>
                          <span class="ss">:name</span> <span class="s">&quot;task&quot;</span>
                          <span class="ss">:placeholder</span> <span class="s">&quot;Task&#39;s title&quot;</span><span class="p">)</span>
                  <span class="p">(</span><span class="ss">:input</span> <span class="ss">:type</span> <span class="s">&quot;submit&quot;</span>
                          <span class="ss">:value</span> <span class="s">&quot;Add&quot;</span><span class="p">)))))))</span><span class="go"></span>
</pre></div>
</div>
<p>This code has the following significant changes:</p>
<ul>
<li><p class="first">Now we store our tasks as structures to be able to change their state
easily:</p>
<div class="highlight-common-lisp"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">defstruct</span> <span class="nv">task</span>
   <span class="p">(</span><span class="nv">title</span><span class="p">)</span>
   <span class="p">(</span><span class="nv">done</span><span class="p">))</span>
</pre></div>
</div>
<p>And now they have the additional attribute <code class="docutils literal"><span class="pre">done</span></code> for indication if we&#8217;re
done with a task or not.</p>
</li>
<li><p class="first">The next change is a small helper to toggle the <code class="docutils literal"><span class="pre">done</span></code> attribute:</p>
<div class="highlight-common-lisp"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">toggle-task</span> <span class="p">(</span><span class="nv">task</span><span class="p">)</span>
   <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nv">task-done</span> <span class="nv">task</span><span class="p">)</span>
         <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">task-done</span> <span class="nv">task</span><span class="p">)</span>
             <span class="no">nil</span>
             <span class="no">t</span><span class="p">))</span>
   <span class="p">(</span><span class="nv">redraw</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p class="first">And finally, we&#8217;ve modified our task rendering function by adding a
code to render a checkbox with an anonymous lisp function, attached to
its <code class="docutils literal"><span class="pre">onclick</span></code> attribute:</p>
<div class="highlight-common-lisp"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">with-html</span>
   <span class="p">(</span><span class="ss">:p</span> <span class="p">(</span><span class="ss">:input</span> <span class="ss">:type</span> <span class="s">&quot;checkbox&quot;</span>
               <span class="ss">:checked</span> <span class="nv">done</span>
               <span class="ss">:onclick</span> <span class="p">(</span><span class="nv">weblocks/actions:make-js-action</span>
                         <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="k">&amp;rest</span> <span class="nb">rest</span><span class="p">)</span>
                           <span class="p">(</span><span class="k">declare</span> <span class="p">(</span><span class="k">ignore</span> <span class="nb">rest</span><span class="p">))</span>
                           <span class="p">(</span><span class="nv">toggle-task</span> <span class="nv">task</span><span class="p">))))</span>
       <span class="p">(</span><span class="ss">:span</span> <span class="p">(</span><span class="k">if</span> <span class="nv">done</span>
                  <span class="p">(</span><span class="nv">with-html</span> <span class="p">(</span><span class="ss">:s</span> <span class="nv">title</span><span class="p">))</span>
                  <span class="nv">title</span><span class="p">))))</span>
</pre></div>
</div>
<p>The function <code class="docutils literal"><span class="pre">make-js-action</span></code> returns a Javascript code, which
calls back a lisp lambda function when evaluated in the browser.
And because <code class="docutils literal"><span class="pre">toggle-task</span></code> updates the root widget, Weblocks
returns on this callback a new prerendered HTML with all tasks.
In next tutorial I&#8217;ll show how to rerender only a single task on such changes.</p>
</li>
</ul>
<div class="section" id="what-is-next">
<h2>What is next?<a class="headerlink" href="#what-is-next" title="Permalink to this headline">¶</a></h2>
<p>As a homework:</p>
<ol class="arabic simple">
<li>Play with lambdas and add a &#8220;Delete&#8221; button next after
each task.</li>
<li>Add the ability to sort tasks by name or by completion flag.</li>
<li>Read the rest of the documentation and make a real application, using the full
power of Common Lisp.</li>
</ol>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/quickstart.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2017, group of lisp hackers.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.9.<br/>
    </p>
  </div>
</footer>
  </body>
</html>